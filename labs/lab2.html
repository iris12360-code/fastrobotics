<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MAE 4190 â€“ Lab 1</title>

  <style>
    body {
      font-family: Arial, sans-serif;
    }

    .content {
      max-width: 800px;
      margin: 60px auto;
      padding: 0 20px;
    }

    h1 { font-size: 2.2em; }
    h2 { font-size: 1.6em; margin-top: 40px; }
    h3 { font-size: 1.3em; margin-top: 20px; }
    p  { line-height: 1.6; }

    img {
      display: block;
      margin: 20px auto;
      max-width: 100%;
    }

    .code-block {
  margin: 30px 0;
}

.code-header {
  background-color: #eaeaea;
  padding: 6px 12px;
  font-size: 0.9em;
  font-family: monospace;
  border-radius: 6px 6px 0 0;
}

.code-header span {
  font-weight: bold;
}

.code-block pre {
  margin: 0;
  background-color: #f5f5f5;
  padding: 16px;
  overflow-x: auto;
  border-radius: 0 0 6px 6px;
}

code {
  font-family: Consolas, Monaco, monospace;
  font-size: 0.95em;
}

  </style>
</head>

<body>
    <div class="content">

    <h1>Lab 2: Artemis + Bluetooth </h1>

    <h2> Set up the IMU </h2>

  <img src="../images/lab2/IMU_setup.jpg" alt="IMU connections" width="350">
  <p>I wrote code to alternatively light up the LED twice to mark the starting.
   It lights up first when the connection works at the beginning, so the video includes
    three flashes.</p>
  
    <div class="code-block">
  <div class="code-header">File: lab2.ino</div>
  <pre><code>
  // LED light up two times with an interval of two seconds
  digitalWrite(LED_BUILTIN, HIGH);
  delay(1000);
  digitalWrite(LED_BUILTIN, LOW);
  delay(2000);
  digitalWrite(LED_BUILTIN, HIGH);
  delay(1000);
  digitalWrite(LED_BUILTIN, LOW);
  </code></pre>
  </div>
  <a href="https://youtube.com/shorts/_lV_BpnmZKY?si=g9R65DuorTzkpHvX" target="_blank">
  Watch the video of flashing light indicating example code works on IMU</a>
  
  <p>AD0_VAL definition discussion: AD0_VAL represents a constant reflecting the state
     of an ADR jumper. When the ADR 
  jumper is open, AD0_VAL should be 1. While the ADR jumper is closed, AD0_VAL should 
  be 0. It should be 1 now as the ADR jumper is not soldered. If the ADR jumper is soldered,
   it can enable multiple sensors to be on the same I2C bus. 
</p>
 
<img src="../images/lab2/X_axis_rotation.jpg" alt="IMU connections" width="450">
<img src="../images/lab2/Y_axis_flip.jpg" alt="IMU connections" width="450">
<img src="../images/lab2/X_axis_speedup.jpg" alt="IMU connections" width="450">
<p>
Picture above in order demonstrate rotation along X axis, flip along Y axis,
 and speedup along X axis. 
</p>

    <h2>Accelerometer </h2>
<img src="../images/lab2/roll_rawdata.png" alt="IMU connections" width="550">
<img src="../images/lab2/pitch_rawdata.png" alt="IMU connections" width="550">

    <div class="code-block">
  <div class="code-header">File: lab2.ino</div>
  <pre><code>
    //Calculation of angles of Pitch/Roll in degrees 
    acc_roll = atan2(ay, az) * 180.0 / M_PI;
    acc_pitch = atan2(-ax, sqrt(ay*ay + az*az)) * 180.0 / M_PI;
  </code></pre>
  </div>

  <p>
I directly used data point from output of pitch and roll to conduct the two-point calibration:<br>
Average Pitch Degrees in negative direction: -86.23 degrees<br>
Average Pitch Degrees at zero: 0.06 degrees<br>
Conversion factor: (0-(-90))/(0.06-(-86.23))= 1.043<br>
Average Roll Degrees in negative direction: -87.66 degrees<br>
Average Roll Degrees at zero: 0.06 degrees: 0.49 degrees<br>
Conversion factor: (0-(-90))/(0.49-(-87.66))= 1.021<br>
Average Conversion Factor: (1.021+1.043)/2 = 1.032<br>
Therefore, I think my accelerometer is relatively accurate with a 3.2% error.<br>
</p>

<p>
In the process of ploting and noise analysis in the frequency spectrum, I got to review
concepts of start_notify and send_command again: start_notify is to have python on to
listen/wait for arduino actions; seond_command is to have arduino take the action and 
have notification handler run. Before I started the notification and sent the command,
 I added clearing to all the lists to ensure they are empty before the calling of the 
 notification handler. Besides, I added add_list = True to filter out the BLE messages
  before calling the GET_ACC function from the arduino. 
</p>

    <div class="code-block">
  <div class="code-header">File: lab2.ipynb</div>
  <pre><code>
  time_list.clear()
  acc_pitch_list.clear()
  acc_roll_list.clear()
  add_list = True 

  ble.start_notify(ble.uuid['RX_STRING'], notification_handler)
  ble.send_command(CMD_lab2.GET_ACC, "") 
  </code></pre>
  </div>

  <img src="../images/lab2/acc_raw_600.png" alt="Raw Data Ploting in size of 600" width="450">
</p>
When I left it on the steady table, I did not see some apparent spikes in its distribution
 of the noise standing out in a specific range of frequency. <br>

However, I can exactly see the difference when I try to shake it at a constant frequency in
 the time spectrum. In the frequency spectrum, I see obvious peaks between 4-6 Hz despite the
  spike at 0 Hz for roll. I think it is safe to adopt a cut off frequency at 6Hz, as a low pass 
  filter will intentionally preserve the low-frequency motion with erasing high-frequency noises.
   If I pick a lower frequency than that, there will be a chance that the interesting motion 
   I want to capture will be cut off. Based on my graph, I picked 2.5 Hz as my cut-off frequency.  
</p>
  <img src="../images/lab2/acc_low_1000.png" alt="Low-pass Data Ploting in size of 1000" width="450">
</p>
A filter at array size of 600 previously would not be able to achieve suppressing noises strongly.
 The current alpha is 0.4895 with an array size of 1000 compared to previously 0.627, which achieves a
 a better filter. Throughout the debugging process, I learned to put _static_ inside the function for
 input angles and checkfirst boolean function to _enables the variables to remember their last values
  from changes_ inside the function until the next time it runs again.
</p>


    <h2> Gyroscope</h2>
    <h2> Sample Data</h2>
    <h2> Record a Stunt </h2>
    <a href="https://youtu.be/iNH_kK5zv_E?si=h0ATEQUmRzyzoR_J" target="_blank">
  Watch the video of RC car exploring its first steps as A RC CAR in Philips hallway</a>
    <h2> Reference </h2>

    











<div class="code-block">
  <div class="code-header">File: main.ino</div>
  <pre><code>...</code></pre>
</div>

<p>
    $\tau = RC = frac{1}{2pif_c} = 0.0637$
  $\alpha = frac{dt}{tau + dt} = 0.4896 $
</p>

<p></p>

  </div>   
</body>
</html>
